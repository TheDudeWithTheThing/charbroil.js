<!DOCTYPE html>  <html> <head>   <title>jquery.charbroil.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jquery.charbroil.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Project: Charbroil
 Description: A simple library which looks for all links in the
              selected element and makes hot keys for them based on the first available letter.
              Take a char and making it HOT, thus charbroil.
 Author: Shaun Butler
 License: MIT</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="nf">($, window) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Create the defaults once</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pluginName = </span><span class="s">&#39;charbroil&#39;</span>
  <span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span>
  <span class="nv">defaults =</span>
    <span class="nv">hot_key_css_class: </span><span class="s">&#39;charbroil-hot&#39;</span>
    <span class="nv">modifier: </span><span class="s">&#39;ctrl&#39;</span>
    <span class="nv">exclude: </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The actual plugin constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">class</span> <span class="nx">Charbroil</span>
    <span class="nv">constructor: </span><span class="nf">(@element, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>jQuery has an extend method which merges the contents of two or
more objects, storing the result in the first object. The first object
is generally empty as we don't want to alter the default options for
future instances of the plugin</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@options = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span>

      <span class="vi">@_defaults = </span><span class="nx">defaults</span>
      <span class="vi">@_name = </span><span class="nx">pluginName</span>
      <span class="vi">@_letter_score = </span><span class="p">[]</span>

      <span class="nx">@init</span><span class="p">()</span>

    <span class="nv">init: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>get all <a> links</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@load_links</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>for all the links we found inside the selector, count characters inside the A</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">link</span> <span class="k">in</span> <span class="nx">@links</span>
        <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span>
        <span class="nv">text = </span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span>
        <span class="k">for</span> <span class="nx">l</span> <span class="k">in</span> <span class="nx">text</span>
          <span class="nv">index = </span><span class="nx">l</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
          <span class="nx">@_letter_score</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@_letter_score</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">is</span> <span class="s">&#39;undefined&#39;</span>
          <span class="nx">@_letter_score</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span><span class="o">++</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>find data attribute keys</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">link</span> <span class="k">in</span> <span class="nx">@links</span>
        <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>the shortcut letter from data attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">letter = </span><span class="nx">$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;data-charbroil-key&#39;</span><span class="p">)</span>
        <span class="nv">text = </span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span>
        <span class="k">if</span> <span class="o">!</span><span class="nx">@is_valid_letter</span> <span class="nx">letter</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>or do first letter</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">letter = </span><span class="nx">text</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span>
          <span class="k">continue</span> <span class="k">if</span> <span class="o">!</span><span class="nx">@is_valid_letter</span> <span class="nx">letter</span>
        <span class="nx">@build_char_link</span><span class="p">(</span><span class="nx">letter</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">$el</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>now we try to be smart</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">link</span> <span class="k">in</span> <span class="nx">@links</span>
        <span class="k">continue</span> <span class="k">if</span> <span class="nx">@has_charbroil_span</span> <span class="nx">link</span>
        <span class="nv">text = </span><span class="nx">$</span><span class="p">(</span><span class="nx">link</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span>
        <span class="nv">letter = </span><span class="nx">@find_lowest_score_letter</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span>
        <span class="k">continue</span> <span class="k">if</span> <span class="o">!</span><span class="nx">@is_valid_letter</span> <span class="nx">letter</span>
        <span class="nx">@build_char_link</span><span class="p">(</span><span class="nx">letter</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">text</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">link</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>for chaining</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@element</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>is the letter valid and not used already?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">is_valid_letter: </span><span class="nf">(letter) -&gt;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">letter</span> <span class="o">&amp;&amp;</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">exclude</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>contains a hot letter already?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">has_charbroil_span: </span><span class="nf">(link) -&gt;</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">link</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;span.&#39;</span> <span class="o">+</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hot_key_css_class</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>builds the link using the element, letter and inner text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">build_char_link: </span><span class="nf">(letter, text, link) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>mark it as used</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@options</span><span class="p">.</span><span class="nx">exclude</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span>
      <span class="nv">text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="nv">shortcut = </span><span class="nx">@build_shortcut_string</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>class string to be added to the link</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">shortcut_class_name = </span><span class="nx">@build_shortcut_class_name</span> <span class="nx">shortcut</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>class to use when there are multiple classes for finding <a></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">finder_class_name = </span><span class="nx">@get_finder_class_name</span> <span class="nx">shortcut_class_name</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>create span for adding class to letter</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">replace_with = </span><span class="s">&#39;&lt;span class=&quot;&#39;</span> <span class="o">+</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hot_key_css_class</span> <span class="o">+</span> <span class="s">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">letter</span> <span class="o">+</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
      <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>replace letter with span wrapped version of letter</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="nx">letter</span><span class="p">,</span> <span class="nx">replace_with</span><span class="p">)</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>add shortcut class to link so we can find this later</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">shortcut_class_name</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>bind key using keymaster</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">key</span> <span class="nx">shortcut</span><span class="p">,</span> <span class="nf">(e, h) -&gt;</span>
        <span class="nv">shortcut_class_name = </span><span class="s">&#39;charbroil-&#39;</span> <span class="o">+</span> <span class="nx">h</span><span class="p">.</span><span class="nx">shortcut</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="nb">window</span><span class="p">.</span><span class="nv">location = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">shortcut_class_name</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>get all a tags in element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">load_links: </span><span class="o">-&gt;</span>
      <span class="vi">@links = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@element</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>returns the least used letter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">find_lowest_score_letter: </span><span class="nf">(word) -&gt;</span>
      <span class="k">for</span> <span class="nx">char</span> <span class="k">in</span> <span class="nx">word</span>
        <span class="k">if</span> <span class="nx">@is_valid_letter</span><span class="p">(</span><span class="nx">char</span><span class="p">)</span> 
          <span class="k">if</span> <span class="o">!</span><span class="nx">score</span> <span class="o">||</span> <span class="p">(</span><span class="nx">score</span> <span class="o">&amp;&amp;</span> <span class="nx">@_letter_score</span><span class="p">[</span><span class="nx">char</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">score</span><span class="p">)</span>
            <span class="nv">letter = </span><span class="nx">char</span>
            <span class="nv">score = </span><span class="nx">@_letter_score</span><span class="p">[</span><span class="nx">char</span><span class="p">]</span>
      <span class="nx">letter</span>

    <span class="nv">build_shortcut_string: </span><span class="nf">(letter) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>accept an array of strings for modifier list</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">modifier</span> <span class="k">instanceof</span> <span class="nb">Array</span>
        <span class="nv">mods = </span><span class="p">(</span><span class="nx">mod</span> <span class="o">+</span> <span class="s">&#39;+&#39;</span> <span class="o">+</span> <span class="nx">letter</span> <span class="k">for</span> <span class="nx">mod</span> <span class="k">in</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">modifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">mods</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;,&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>or a single string</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span>
        <span class="k">return</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">modifier</span> <span class="o">+</span> <span class="s">&#39;+&#39;</span> <span class="o">+</span> <span class="nx">letter</span>

    <span class="nv">build_shortcut_class_name: </span><span class="nf">(keys) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>replace + with - and split by , for sane class names</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">classes = </span><span class="p">(</span><span class="s">&#39;charbroil-&#39;</span> <span class="o">+</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+/g</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">split</span> <span class="sr">/,/</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39; &#39;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>just gets first class name all the time to use as a reference to element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">get_finder_class_name: </span><span class="nf">(shortcut_classes) -&gt;</span>
      <span class="nv">classes = </span><span class="nx">shortcut_classes</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">classes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>A really lightweight plugin wrapper around the constructor,
preventing against multiple instantiations
part of coffeescript jquery boilerplate</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span><span class="nx">pluginName</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(options) -&gt;</span>
    <span class="nx">@each</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&quot;plugin_</span><span class="si">#{</span><span class="nx">pluginName</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;plugin_</span><span class="si">#{</span><span class="nx">pluginName</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Charbroil</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">options</span><span class="p">))</span>
<span class="p">)(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nb">window</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 